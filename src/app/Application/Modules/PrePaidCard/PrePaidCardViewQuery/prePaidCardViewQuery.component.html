<div class="sme-breadcrumb">
    <ol class="breadcrumb">
        <li class="active"><a href="#">{{ 'prePaidCard.name' | translate }}</a>
        </li>
        <li class="active"><a href="#" [routerLink]="['/prepaid-card/prepaidcardlist']">{{ 'prePaidCard.prePaidCardList'
                | translate }}</a>
        </li>
        <li class="active">{{ 'prePaidCard.prepaidCardID' | translate:{id: cardNumber | hiddenAccount} }}</li>
    </ol>
</div>

<div>
    <div class="container-fluid">
        <div class="sme-page-block">
            <div class="sme-form">
                <div class="sme-form__form">
                    <div class="sme-form__content">
                        <div class="sme-form__body">
                            <div id="target-data" class="target-data"
                                *ngIf="detailsListIterable && detailsListIterable.length>0; else noData">

                                <ngb-carousel [showNavigationArrows]="showArrowsOption()" [interval]=0
                                    [pauseOnHover]="false" class="carousel-own-styles" (slide)="onSlide($event)"
                                    #myCarousel="ngbCarousel">

                                    <ng-template ngbSlide *ngFor="let card of detailsListIterable; let j = index"
                                        ngbSlide [id]="'slideId_'+j">
                                        <div class=" flex-wrap">
                                            <div class="carousel-details">
                                                <div id="target" class="frame-target">
                                                    <div class="head-list" style="margin-top: 5px">
                                                        <div id="image" class="display-div-column">
                                                            <span class="image-medium-target-prepaid"></span>
                                                        </div>
                                                    </div>
                                                    <div class="body-list-details">
                                                        <div class="body-list">
                                                            <div class="titlePin message">
                                                                <span
                                                                    class="form-control disabled border-none">{{card.list?.embossingName}}</span>
                                                                <!-- <span
                                                                    class="form-control disabled border-none">{{currentUser.userName}}</span> -->
                                                            </div>
                                                            <div class="titlePin message">
                                                                <span class="border-none">{{card.list?.cardNumber
                                                                    | hiddenAccount }}</span>
                                                                <!-- <span
                                                                    class="border-none">{{card.details?.prepaidCardDetails?.accountNumber
                                                                    | hiddenAccount }}</span> -->
                                                            </div>
                                                            <div class="progress-bar-ext">
                                                                <div
                                                                    [ngStyle]="{'width': target | cardBalancePercentage}">
                                                                </div>
                                                            </div>

                                                            <div class="titlePin message">
                                                                <div class="body-list-details">
                                                                    <div>
                                                                        <!-- requested by bank  -->
                                                                        <!-- <span
                                                                            class="text-legend">{{'prePaidCard.25spent'
                                                                            | translate | uppercase }}</span> -->
                                                                    </div>
                                                                    <div>
                                                                        <!-- <span
                                                                            class="border-none">{{card.list?.rewardPoints
                                                                            | amountCurrency }}</span> -->
                                                                    </div>
                                                                </div>
                                                                <div class="body-list-details line-separator">
                                                                    <div>
                                                                         <!-- requested by bank  -->
                                                                        <!-- <span
                                                                            class="text-legend">{{'prePaidCard.totalCredit'
                                                                            | translate | uppercase }}</span> -->
                                                                    </div>

                                                                    <div>
                                                                        <!-- <span
                                                                            class="border-none navy-bold">{{card.list?.totalAmt
                                                                            | amountCurrency }}</span> -->
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id=" data" class="frame-target-data border-separator">
                                                    <div class="column-first-data">
                                                        <div class="details-group">
                                                            <div>
                                                                <span class="text-legend">
                                                                    {{'prePaidCard.cardBalance' | translate
                                                                    }}</span>
                                                            </div>
                                                            <div>
                                                                <span
                                                                        class="border-none">{{detailsListIterable[indexSelected]?.details?.prepaidCardDetails?.accountsItemList[0]?.availableBalance
                                                                    | amountCurrency }}</span>
                                                            </div>
                                                        </div>
                                                        <div class="details-group">
                                                            <div>
                                                                <span class="text-legend">{{'prePaidCard.creationDate' |
                                                                    translate}}</span>
                                                            </div>
                                                            <div> <span
                                                                    class="border-none">{{card.details?.prepaidCardDetails?.creationDate
                                                                    }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="column-second-data">
                                                        <div class="details-group">
                                                            <div>
                                                                <span
                                                                    class="text-legend">{{'prePaidCard.creditLimit'
                                                                    | translate }}</span>
                                                            </div>
                                                            <div>
                                                                <span
                                                                    class="border-none">{{card.details?.prepaidCardDetails?.cardLimitAmount
                                                                    | amountCurrency }}</span>
                                                            </div>
                                                        </div>
                                                        <div class="details-group">
                                                            <div>
                                                                <span class="text-legend">{{'prePaidCard.expiryDate' |
                                                                    translate}}</span>
                                                            </div>
                                                            <div> <span
                                                                    class="border-none">{{card.details?.prepaidCardDetails?.expiryDate
                                                                    }}</span>
                                                            </div>
                                                        </div>
                                                        <div class="details-group">
                                                            <div>
                                                                <span class="text-legend">
                                                                    {{'prePaidCard.status' | translate }}</span>
                                                            </div>
                                                            <div>
                                                                <span
                                                                    class="border-none">{{card.details?.prepaidCardDetails?.cardStatus
                                                                    | businessCardStatus
                                                                    }}</span>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="icon-column" class="column-icon">
                                                        <div class="col">
                                                            <app-dropdown-actions-prepaid-card-details
                                                                [selectedPrepaidCard]="selectedPrepaidCard"
                                                                [prepaidCardDetailList]="prepaidCardDetailList"
                                                                [selectedCardId]="selectedCardId">
                                                            </app-dropdown-actions-prepaid-card-details>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngb-carousel>
                            </div>
                            <ng-template #noData>
                                <div class="sme-form__body">
                                    <div class="noTargetsData">
                                        <span class="text-legend">{{'prePaidCard.noTargetsData' | translate }}</span>
                                    </div>
                                </div>
                            </ng-template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="tabs">
    <div class="sme-page-block tabs-button">
        <button type="button" class=" btn btn-default btn-wide tabs-cards btn-adapt" (click)="activeTransactions()"
            [disabled]="transactionsTab">{{'prePaidCard.transactions' | translate | uppercase }}</button>
        <button type="submit" class=" btn btn-default btn-wide tabs-cards btn-adapt" (click)="activeStatements()"
            [disabled]="statementsTab">{{'prePaidCard.statements' | translate | uppercase}}</button>
    </div>
</div>

<div id="transactions" class="{{!transactionsTab? 'tab-disabled':'tab-enabled'}}">

    <div class="container-fluid">
        <div class="sme-page-block">
            <div class="sme-form">
                <div class="sme-form__form">
                    <div class="sme-form__content">
                        <div class="sme-form__body">
                            <div id="target-data" class="target-data">
                                <div id="table" class="search">
                                    <div class="sme-form__content">
                                        <a (click)="isSearchCollapsed = !isSearchCollapsed"
                                            class="sme-form__head human-selectable"
                                            [ngClass]="{'collapsed': isSearchCollapsed}">
                                            <span>{{ 'public.search' | translate }}</span>
                                        </a>
                                        <div class="sme-form__collapse" id="sme-demo--form--search-criteria-"
                                            [collapse]="isSearchCollapsed">

                                            <form class="sme-form__form" [formGroup]="searchForm">
                                                <div class="sme-form__body">
                                                    <div class="payment-options-group">
                                                        <div class="form-field-30 ">
                                                            <div class="form-group">
                                                                <label>{{ 'prePaidCard.category' | translate }}</label>
                                                                <div
                                                                    class="sme-select searchFormSelect form-control select-flex-width">
                                                                    <select id="deduct-from-account-input"
                                                                        class="form-control" formControlName="category">
                                                                        <option value="" [selected]>
                                                                            -- {{ 'public.all' | translate }} --
                                                                        </option>
                                                                        <option *ngFor="let account of comboCategories"
                                                                            [value]="account.key">{{account.value}}
                                                                        </option>
                                                                    </select>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-field-20" formGroupName="amountForm">
                                                            <div class="form-group input-flex-width">
                                                                <label>{{ 'prePaidCard.amount' | translate }}
                                                                </label>
                                                                <input
                                                                    placeholder="{{ 'prePaidCard.from' | translate }}"
                                                                    type="number" step="0.01" name="amountFrom"
                                                                    class="form-control" formControlName="amountFrom"
                                                                    inputPattern="onlyDecimalNumbers">
                                                            </div>
                                                        </div>
                                                        <div class="form-field-20" formGroupName="amountForm">
                                                            <div class="form-group input-flex-width">
                                                                <label>
                                                                </label>
                                                                <input placeholder="{{ 'prePaidCard.to' | translate }}"
                                                                    type="number" step="0.01" name="amountTo"
                                                                    class="form-control" formControlName="amountTo"
                                                                    inputPattern="onlyDecimalNumbers">
                                                            </div>
                                                        </div>
                                                        <div class="form-field-20" formGroupName="dateForm">
                                                            <div class="form-group input-flex-width">
                                                                <label>{{ 'prePaidCard.date' | translate }}
                                                                </label>
                                                                <input
                                                                    placeholder="{{ 'prePaidCard.from' | translate }}"
                                                                    type="text" formControlName="dateFrom"
                                                                    name="dateFrom" style="z-index: 1000"
                                                                    class="form-control" #dateFrom="bsDatepicker"
                                                                    bsDatepicker [bsConfig]="bsConfig" />
                                                            </div>
                                                        </div>
                                                        <div class="form-field-20" formGroupName="dateForm">
                                                            <div class="form-group input-flex-width">
                                                                <label>
                                                                </label>
                                                                <input placeholder="{{ 'prePaidCard.to' | translate }}"
                                                                    type="text" name="amountTo" style="z-index: 1000"
                                                                    formControlName="dateTo" class="form-control"
                                                                    #dateFrom="bsDatepicker" bsDatepicker
                                                                    [bsConfig]="bsConfig" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="payment-options-group">
                                                        <div class="form-field-25"></div>
                                                        <div class="form-field-30">
                                                            <div *ngIf="searchForm.get('amountForm').errors?.errorRange"
                                                                class="alert alert-danger small-screen-error">
                                                                <small>
                                                                    {{'prePaidCard.amountMessageError' | translate }}
                                                                </small>
                                                            </div>
                                                        </div>
                                                        <div class="form-field-5"></div>
                                                        <div class="form-field-5"></div>
                                                        <div class="form-field-30">
                                                            <div *ngIf="searchForm.get('dateForm').errors?.errorRange"
                                                                class="alert alert-danger small-screen-error">
                                                                <small>
                                                                    {{'prePaidCard.dateMessageError' | translate }}
                                                                </small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="sme-form__actions">
                                                        <button type="button" class="btn btn-default btn-wide"
                                                            [disabled]="!searchForm.dirty" (click)="resetSearchForm()">
                                                            {{ 'public.reset' | translate }}
                                                        </button>
                                                        <button type="submit" [disabled]="!searchForm.valid"
                                                            (click)="onSearchForm()" class="btn btn-primary btn-wide">
                                                            {{ 'public.search' | translate }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="sme-page-block">

            <div class="sme-data-table">
                <div class="sme-data-table__head">
                    <div class="sme-data-table__export">
                        <table-export [dataTable]="detailsPageTable"
                            [header]="'prePaidCard.commercialCardDetails' | translate" [columns]="[
                            {'title': 'prePaidCard.date' | translate, 'dataKey': 'date'},
                            {'title': 'prePaidCard.mechant' | translate, 'dataKey': 'merchantName'},
                            {'title': 'prePaidCard.amount' | translate, 'dataKey': 'amount'},
                            {'title': 'commercialCards.billingAmount' | translate, 'dataKey': 'billingAmount'}]">
                        </table-export>

                    </div>
                </div>
                <div>
                    <div class="sme-table table headerDataTable">
                        <ngx-datatable [messages]="{emptyMessage: 'public.noData' | translate}" #detailsPageTable
                            class="material sme-table sme-table--responsive table" [rows]="detailsPage.data"
                            [columnMode]="defaultColumnMode" [headerHeight]="30" [footerHeight]="footerHeight"
                            [rowHeight]="defaultHeight" [externalPaging]="true" [externalSorting]="true"
                            [offset]="detailsPage.page.pageNumber" [count]="detailsPage.page.totalElements"
                            [limit]="detailsPage.page.pageSize" [selectionType]="defaultSelectionType"
                            [rowIdentity]="getIdFunction()" (page)="setPage($event)" (select)='onSelect($event)'>
                            <ngx-datatable-row-detail [rowHeight]="defaultHeight" #myDetailRow
                                (toggle)="onDetailToggle($event)">


                                <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>

                                    <div class="row">
                                        <fieldset>
                                            <div class="col-xs-6">
                                                <!-- sme-form-group -->
                                                <div class="form-group">
                                                    <label for="user1-input-name">{{'prePaidCard.date' | translate
                                                        }}</label>
                                                    <div>
                                                        <span>{{ row.date | date: "yyyy-MM-dd" }}</span>
                                                    </div>
                                                </div>
                                            </div>>
                                            <div class="col-xs-6">
                                                <!-- sme-form-group -->
                                                <div class="form-group">
                                                    <label for="user1-input-name">{{'prePaidCard.mechant' |
                                                        translate
                                                        }}</label>
                                                    <div>
                                                        <span>{{ row.merchantName }}</span>

                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="row">
                                        <fieldset>
                                            <div class="col-xs-6">
                                                <!-- sme-form-group -->
                                                <div class="form-group">
                                                    <label for="user1-input-name">{{'prePaidCard.amount' | translate
                                                        }}</label>
                                                    <div>
                                                        <span>{{ row.amount }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-6">
                                                <!-- sme-form-group -->
                                                <div class="form-group">
                                                    <label for="user1-input-name">{{'commercialCards.billingAmount'
                                                        |
                                                        translate }}</label>
                                                    <div>
                                                        <span>{{ row.billingAmount }}
                                                            {{ row.billingCurrency | amountCurrency }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </ng-template>

                            </ngx-datatable-row-detail>

                            <!-- <ngx-datatable-column [width]="50" [sortable]="false" [canAutoResize]="false"
                                [draggable]="false" [resizeable]="false" [headerCheckboxable]="true"
                                [checkboxable]="true">
                            </ngx-datatable-column> -->

                            <ngx-datatable-column prop="date">
                                <ng-template let-value="name" let-sort="sortFn" ngx-datatable-header-template>
                                    <span (click)="sort()" class="datatable-header-cell-wrapper">
                                        {{'prePaidCard.date' | translate }}
                                    </span>
                                </ng-template>
                                <ng-template let-value="value" ngx-datatable-cell-template>
                                    <span>{{ value | date : "yyyy-MM-dd"}}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column prop="merchantName">
                                <ng-template let-value="name" let-sort="sortFn" ngx-datatable-header-template>
                                    <span (click)="sort()" class="datatable-header-cell-wrapper">
                                        {{'prePaidCard.mechant' | translate }}
                                    </span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column prop="amount">
                                <ng-template let-value="name" let-sort="sortFn" ngx-datatable-header-template>
                                    <span (click)="sort()" class="datatable-header-cell-wrapper">
                                        {{'prePaidCard.amount' | translate }}
                                    </span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-column prop="billingAmount">
                                <ng-template let-value="name" let-row="row" let-sort="sortFn"
                                    ngx-datatable-header-template>
                                    <span (click)="sort()" class="datatable-header-cell-wrapper">
                                        {{'commercialCards.billingAmount' | translate }}
                                    </span>
                                </ng-template>
                                <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
                                    <span class="mobile-hidden">{{ value }}
                                        {{ row.billingCurrency }}</span>
                                </ng-template>
                            </ngx-datatable-column>

                            <ngx-datatable-footer>
                                <ng-template ngx-datatable-footer-template let-rowCount="rowCount"
                                    let-pageSize="pageSize" let-selectedCount="selectedCount" let-curPage="curPage"
                                    let-offset="offset">
                                    <div class="sme-data-table__footer">
                                        <app-datatable-pager
                                            [pagerLeftArrowIcon]="(translate.currentLang === 'en' ? 'datatable-icon-left' : 'datatable-icon-right')"
                                            [pagerRightArrowIcon]="(translate.currentLang === 'en' ? 'datatable-icon-right' : 'datatable-icon-left')"
                                            [pagerPreviousIcon]="(translate.currentLang === 'en' ? 'datatable-icon-prev' : 'datatable-icon-skip')"
                                            [pagerNextIcon]="(translate.currentLang === 'en' ? 'datatable-icon-skip' : 'datatable-icon-prev')"
                                            [page]="curPage" [size]="pageSize" [count]="rowCount"
                                            [hidden]="!((rowCount / pageSize) > 1)"
                                            [visiblePagesCount]="visiblePagesCount"
                                            (change)="detailsPageTable.onFooterPage($event)">
                                        </app-datatable-pager>

                                        <div class="sme-data-table__actions form-inline">
                                            <span class="sme-data-table__action-group">{{ 'public.showingLabel' |
                                                translate}}
                                                {{pageSize > rowCount - ((curPage - 1) * pageSize) ? rowCount - ((curPage - 1) * pageSize) : pageSize}}
                                                {{ 'public.ofLabel' | translate}} {{rowCount}}
                                            </span>
                                            <span class="hidden-xs"> | </span>
                                            <span class="sme-data-table__action-group">
                                                <span>{{ 'public.showRowsLabel' | translate}}</span>
                                                <div class="sme-select form-control">
                                                    <select class="form-control"
                                                        [(ngModel)]="this.detailsPage.page.pageSize"
                                                        [ngModelOptions]="{standalone: true}" (change)="setPage(null)">
                                                        <option [value]="10">10</option>
                                                        <option [value]="20">20</option>
                                                        <option [value]="50">50</option>
                                                        <option [value]="100">100</option>
                                                    </select>
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </ng-template>
                            </ngx-datatable-footer>
                        </ngx-datatable>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="statements" *ngIf="statementsTab" class="{{!statementsTab? 'tab-disabled':'tab-enabled'}}">
    <app-statements-list [cardSeqNumber]="selectedCardSeq"></app-statements-list>
</div>

<div class="sme-page-block sme-wizard__navigation sme-form__actions">
    <button type="button" class=" btn btn-default btn-wide"
        [routerLink]="['/prepaid-card/prepaidcardlist']">{{'public.back' | translate }}</button>
    <button type=" button" class=" btn btn-default btn-wide" (click)="previous()"
        [disabled]="prevDisabled()">{{'public.previous' | translate }}</button>
    <button type=" button" class=" btn btn-default btn-wide" (click)="next()"
        [disabled]="nextDisabled()">{{'public.next' | translate }}</button>
    <button type="submit" class=" btn btn-primary btn-wide" (click)="next()">{{'public.proceed' | translate}}</button>
</div>